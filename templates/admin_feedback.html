{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2><i class="fas fa-comments"></i> Feedback for “{{ project.project_name }}”</h2>
  <a href="{{ url_for('admin_portal') }}" class="btn btn-sm btn-outline-primary mb-3">
    <i class="fas fa-arrow-left"></i> Back to Admin
  </a>

  {% if project.ratings %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Rating</th>
        <th>Comment</th>
        <th>Submitted At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for r in project.ratings %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.rating }}/5</td>
        <td>{{ r.comment or '-' }}</td>
        <td>{{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          <button class="btn btn-sm btn-danger delete-feedback" data-id="{{ r.id }}">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <div class="alert alert-info">No feedback yet.</div>
  {% endif %}
</div>

{% block scripts %}
<script>
document.querySelectorAll('.delete-feedback').forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    if(!confirm('Delete this feedback?')) return;
    const id = btn.dataset.id;
    const token = localStorage.getItem('jwtToken');
    const csrf = document.querySelector('meta[name="csrf-token"]').content;
    const res = await fetch(`/admin/feedback/${id}`, {
      method:'DELETE',
      headers:{
        'Authorization':`Bearer ${token}`,
        'X-CSRF-TOKEN':csrf
      },
      credentials:'include'
    });
    if(res.ok) btn.closest('tr').remove();
  });
});
</script>
{% endblock %}
